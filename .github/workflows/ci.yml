name: Publish E2E tests to Mekom NPM Registry

on:
  workflow_dispatch:

env:
  ELECTRON_SKIP_BINARY_DOWNLOAD: 1

jobs:
  publish-npm-release:
    name: "publish to NPM"
    runs-on: ubuntu-latest
    if: github.repository == 'ozone-his/ozone-e2e'
    permissions:
      contents: read
      id-token: write
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: 18
    - run: yarn install
    - run: npx playwright install-deps
    - run: npm adduser --auth-type=legacy --registry=https://nexus.mekomsolutions.net/repository/mks-npm/
      env:
        USERNAME: ${{ secrets.NPM_USERNAME }}
        PASSWORD: ${{ secrets.NPM_TOKEN }}
    - run: yarn publish
      if: "github.event.release.prerelease"
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
